{% extends 'base.html.twig' %}

{% block title %}Chat - Trajet #{{ trajetId }}{% endblock %}

{% block body %}
<div style="max-width: 1200px; margin: 2rem auto; padding: 0 1rem;">
    <div style="background: white; border-radius: 8px; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);">
        <!-- Header -->
        <div style="background: #2563eb; color: white; padding: 1rem; border-radius: 8px 8px 0 0;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <h1 style="font-size: 1.25rem; font-weight: bold; margin: 0;">Chat - Trajet #{{ trajetId }}</h1>
                    {% if trajet %}
                        <p style="color: #bfdbfe; margin: 0.25rem 0 0 0;">{{ trajet.pointDepart }} → {{ trajet.pointArrivee }}</p>
                        <p style="color: #bfdbfe; margin: 0.25rem 0 0 0;">{{ trajet.dateDepart|date('d/m/Y') }} à {{ trajet.heureDepart }}</p>
                    {% endif %}
                </div>
                <a href="{{ path('trajet_rechercher') }}" style="background: #1d4ed8; color: white; padding: 0.5rem 1rem; border-radius: 4px; text-decoration: none; hover: background: #1e40af;">
                    ← Retour
                </a>
            </div>
        </div>

        {% if error %}
            <div style="background: #fef2f2; border: 1px solid #f87171; color: #dc2626; padding: 0.75rem; margin: 1rem; border-radius: 4px;">
                {{ error|raw }}
            </div>
        {% endif %}
        {% if success %}
            <div style="background: #f0fdf4; border: 1px solid #4ade80; color: #16a34a; padding: 0.75rem; margin: 1rem; border-radius: 4px;">
                {{ success }}
            </div>
        {% endif %}

        <!-- Messages -->
        <div style="padding: 1rem; height: 400px; overflow-y: auto; background: #f9fafb;" id="messages-container">
            {% if messages is empty %}
                <div style="text-align: center; color: #6b7280; padding: 2rem;">
                    <p>Aucun message pour le moment.</p>
                    <p style="font-size: 0.875rem;">Commencez la conversation !</p>
                </div>
            {% else %}
                {% for message in messages %}
                    <div style="margin-bottom: 1rem; {% if message.expediteurId == app.user.id %}text-align: right;{% endif %}">
                        <div style="display: inline-block; max-width: 300px; padding: 0.5rem 1rem; border-radius: 8px; {% if message.expediteurId == app.user.id %}background: #2563eb; color: white;{% else %}background: white; border: 1px solid #e5e7eb;{% endif %}">
                            <p style="font-size: 0.875rem; margin: 0;">{{ message.contenu }}</p>
                            <p style="font-size: 0.75rem; margin: 0.25rem 0 0 0; {% if message.expediteurId == app.user.id %}color: #bfdbfe;{% else %}color: #6b7280;{% endif %}">
                                {{ message.dateEnvoi|date('d/m/Y H:i') }}
                                {% if message.lu and message.expediteurId == app.user.id %}
                                    <span style="margin-left: 0.25rem;">✓</span>
                                {% endif %}
                            </p>
                        </div>
                    </div>
                {% endfor %}
            {% endif %}
        </div>

        <!-- Formulaire d'envoi -->
        <div style="padding: 1rem; border-top: 1px solid #e5e7eb; background: white;">
            <form method="post" style="display: flex; gap: 0.5rem;">
                <input type="text" name="contenu" placeholder="Tapez votre message..." 
                       style="flex: 1; border: 1px solid #d1d5db; border-radius: 8px; padding: 0.5rem 0.75rem; outline: none;" 
                       required>
                <button type="submit" style="background: #2563eb; color: white; padding: 0.5rem 1.5rem; border-radius: 8px; border: none; cursor: pointer; hover: background: #1d4ed8;">
                    Envoyer
                </button>
            </form>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const messagesContainer = document.getElementById('messages-container');
    
    // Scroll vers le bas pour voir les nouveaux messages
    function scrollToBottom() {
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }
    
    // Scroll au chargement de la page
    scrollToBottom();
    
    // Auto-refresh toutes les 5 secondes
    setInterval(function() {
        location.reload();
    }, 5000);
});
</script>
{% endblock %} 